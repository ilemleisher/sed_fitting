# SED Fitting with Powderday and Prospector
## Overview
This repository contains code to generate SEDs from mock observations (in progress), fit model SEDs to these mock SEDs (in progress), and infer the dust mass in simulated galaxies to the actual dust mass. The codes used in the first two tasks are adapted from [smlower](https://github.com/smlower/prospector_tutorial) using the packages [```Prospector```](https://github.com/bd-j/prospector) and [```Powderday```](https://github.com/dnarayanan/powderday) and the codes for the third task is original. 

Here is a brief description of the codes currently in the repository:
- ```infer_dustmass.py```: uses generated data from ```Powderday``` SEDs to infer dust mass quantiles for each simulated galaxy within a snapshot. Parameters: ```print/save```: printing versus saving the inferred dust masses to a pickle file. ```para/nonpara```: load data from parametric or nonparametric fitted SED. ```index/num```: load galaxies based on their index or galaxy number. ```snap```: snapshot number you are loading galaxies from. ```first_gal```: first galaxy you want to infer dust mass of. ```last_gal*```: optional parameter. If you just want to infer dust mass of one galaxy, leave blank. If you want a range, this is the last galaxy in the range.
- ```get_dustmass.py```: loads the actual dust masses from ```CAESAR``` galaxies for a given snapshot. Parameters are the same as defined above, except there is no ```para/nonpara```, as that only applies to inferring the dust mass.
- ```compile_dmass.py```: creates a pickled file containing a dictionary with an entry for each galaxy in a given snapshot. Each entry contains the inferred dust mass quantiles and the actual dustmass. Parameters: ```snap```: snapshot you want to analyze. ```para/nonpara```: load data from parametric or nonparametric fitted SED. ```priors``` (optional): specifies the priors used in the SED fitting, depending on the name of the props file.
- ```run_prospector.py```: runs ```Prospector``` for a specified SED and creates an h5 file containing the fitted SED. Parameters: ```snap```: snapshot containing the galaxy you want to analyze. ```gal```: number of galaxy within the specified snapshot that you want to analyze. ```priors```: specifies the prior setup you want to fit with. Either ```original```, ```priors1```, or ```priors2```. ```galaxies```: specify the galaxy-identification code you are using. Either ```caesar```or ```subfind```.
- ```analyze_prospector.py```: analyzes an h5 created with the above script for a given galaxy and creates props files containing the 0.16, 0.5, and 0.84 quantiles of inferred dust mass as well as the same quantiles of stellar mass. Parameters are the same as the above script.
- ```functions.py```: file that defines redundant functions used in ```run_prospector.py``` and ```analyze_prospector.py```.
- ```prospector_array.sh```: bash file that submits a slurm job. Usage: define ```job-name``` in the format ```[snapshot][priors]``` and add ```_smgl``` to specify smuggle galaxies. This sets the priors, snapshot, and galaxy identifying algorithm for ```Prospector``` scripts.
